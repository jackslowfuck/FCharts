$(function(){function throttle(a,b,c){var e,d=new Date,c=c||12;return function(){var f=this,g=arguments;clearTimeout(e),!b&&new Date-d>c?(d=new Date,a.call(f,g)):b&&(e=setTimeout(function(){d=new Date,a.call(f,g)},b))}}function arrToSingle(a){for(var b=0,c=a.length,d=[];c>b;b++)d=d.concat(Array.isArray(a[b])?arguments.callee(a[b]):a[b]);return d}function arrSum(aData,sign){return eval(arrToSingle(aData).join(sign||"+"))}function arrMaximin(a){var b=arrToSingle(a);return{max:MathMax.apply(null,b),min:MathMin.apply(null,b)}}function arrMax(a){return MathMax.apply(null,arrToSingle(a))}function arrMin(a){return MathMin.apply(null,arrToSingle(a))}function pInt(a,b){return parseInt(a,b||10)}function formatVol(a){return(a/1e4).toFixed(2)+"万"}function randomColor(a){return"rgba("+MathRound(255*MathRandom())+","+MathRound(255*MathRandom())+","+MathRound(255*MathRandom())+","+(a||1)+")"}function yAxis(a,b){var c=MathCeil(a.max),d=a.min,e=50,f=MathAbs(MathFloor(b/e)),g=MathCeil((c-d)/f),h=g*f;return{max:c,min:c-h,oneMean:g,yNum:f,yOneSize:b/f,DValue:h}}function createSE(a){return $(DOC.createElementNS(SVG.ns,a.trim()))}function createTitle(a,b,c){for(var g,d=b.appendSE("text",{y:13+.5*a}),e=c.length,f=0;e>f;f++)g=createSE("tspan").text(c[f]),0==f&&g.attr("font-weight","bold"),(1==f||0==f%2)&&g.attr("dx",10),d.append(g);return d}function formatLargeAmo(a){return a>1e8?(a/1e8).toFixed(1)+"亿":a>1e5?(a/1e4).toFixed(1)+"万":a}function yTextCalc(a,b,c,d,e,f,g,h){var j,k,i=a.appendSE("g");for(b/=2,j=0;c>=j;j++)i.appendSE("text",{y:MathFloor(j*d)+29.5+b}).text(formatLargeAmo(e-f*j)+(g?"%":""));return g&&(k=MathFloor(e/(e-h.min)*h.yHeight)+29.5,i.appendSE("text",{y:k+b,fill:"red"}).text("0%"),h.bgline.find(".capi-zero-line").remove(),h.bgline.find("g").appendSE("path",{"class":"capi-zero-line",d:"M1 "+k+"L"+h.mainWidth+" "+k,"stroke-dasharray":"6",stroke:"red"})),a}function initYText(a,b,c,d,e,f,g,h){var i=createSE("g").attr({"class":"capi-yaxis",transform:"translate(-8,0)","text-anchor":"end"});return yTextCalc(i,f,b,c,d,e,g,h).appendTo(a)}function drawYText(a,b,c,d,e,f){var g=yAxis(b,c),h=g.yNum;return $("g",a).remove(),yTextCalc(a,d/2,h,g.yOneSize,g.max,g.oneMean,e,{min:g.min,yHeight:f.yHeight,bgline:f.bgline,mainWidth:f.mainWidth}),{yNum:h,max:g.max,DValue:g.DValue,yOneSize:g.yOneSize}}function createBgLine(a,b,c,d){for(var g,e=a.appendSE("g"),f=0;b>f;f++)g=MathFloor(f*c)+29.5,e.appendSE("path",{d:"M1 "+g+"L"+d+" "+g,stroke:GLOBAL.color.gray}),e.appendSE("path",{d:"M0 "+g+"L-4 "+g,stroke:GLOBAL.color.black})}function Linechart(a,b){this.init(a,b)}function Kchart(a,b){return this.init(a,b)}function addPointFive(a){return MathFloor(a)+.5}function addEllipsis(a){return a?"...":""}function createEvIcon(a,b){return'<div id="nid-'+a.nid+'" class="'+(b?"capi-ev-timeIcon":"capi-evIcon")+' capi-transition" data-'+(b?"istimechart":"iskchart")+'-icon=1 title="'+a.title+'" style="left: '+(a.boxOffsetLeft+a.iconInSvgleft)+"px; top: "+(a.boxOffsetTop+a.iconInSvgTop)+'px;">'+a.iconHtml+"</div>"}function changeTop(a,b,c){if(!a.data("changeTop")){var d=c.boxOffsetLeft+c.translateX+10,e=a.outerWidth(),f=a.outerHeight(),g=pInt(a.css("left")),h=pInt(a.css("top"));f+h>b&&a.css("top",b-f-40),c.loadingLeft&&e+g>d&&a.css("left",d-e-20)}}function loadingImg(a,b,c,d){var e=$(GLOBAL.loadingHtml),f=new Image;a.append(e),f.src=b,f.onload=function(){e.remove(),a.append('<img src="'+b+'" alt="">'),changeTop(a,c,d),e=f=null}}function getComment(a,b){$.ajax({url:siteUrl+"news/loadcomment/"+a,dataType:"json"}).done(function(c){var e,f,g,h,i,j,k,d="";if(c.sum)for(e in c.comments[0]){f=c.comments[0][e],g=0,h="";for(i in c.comments[e])j=c.comments[e][i],h+='<li><div class="user"><div class="content"><p class="blue-text">'+j.nickname+(j.toNickname?" 回复 "+j.toNickname:"")+"</p>"+"<div>"+j.content+"</div>"+'<div class="clearfix reply-time">'+'<time class="fl">'+j.addtime+"</time>"+'<span id="show-'+i+'" class="fr">回复</span>'+"</div>"+"</div>"+'<div id="reply-'+i+'" class="reply-user lightgray-bg-color">'+"<div>"+'<textarea class="form-control"></textarea>'+"<div>"+'<i class="btn btn-default" data-newsId="'+a+'" data-replay="'+i+'" data-type="2">回复</i>'+"</div>"+"</div>"+"</div>"+"</div>"+"</li>",g++;d+='<li class="wrap"><div class="content"><p class="blue-text">'+f.nickname+(f.toNickname?" 回复 "+f.toNickname:"")+"</p>"+"<div>"+f.content+"</div>"+'<div class="clearfix reply-time">'+'<time class="fl">'+f.addtime+"</time>"+'<span id="show-'+e+'" class="fr">回复('+g+")</span>"+"</div>"+"</div>"+'<div id="reply-'+e+'" class="reply-user lightgray-bg-color">'+"<div>"+'<textarea class="form-control"></textarea>'+"<div>"+'<i class="btn btn-default" data-newsId="'+a+'" data-replay="'+e+'" data-type="1">回复</i>'+"</div>"+"</div>"+'<ol class="user-sec">'+h+"</ol>"+"</div>"+"</li>"}k='<div class="comment-submit"><p class="bold">评论（'+c.sum+"）</p>"+'<textarea class="form-control" placeholder="发表评论，至少输入5个字"></textarea>'+'<div class="align">'+'<span class="btn btn-default" data-newsId="'+a+'" data-replay="0" data-type="0">发布</span>'+"</div>"+"</div>"+'<ul class="comment-list">'+d+"</ul>",$(".capi-loading-svg",b).remove(),b.append($(k))})}function setEvCon(a,b,c,d,e,f){$(".capi-loading-svg",a).remove(),a.append(b).css("height","auto");var g=a.outerHeight();g>320?c.css("height",c.outerHeight()):($("footer",a).addClass("capi-pos-footer"),c.css("height",340)),changeTop(c,e,f)}function loadingArticle(a,b,c,d){var e=a.data("con"),f=a.attr("id").substring(4),g=$("<div>").attr("class","capi-con-wrap fl");g.append(GLOBAL.loadingSVG),b.append('<span class="capi-gly-com" data-nid="'+f+'" title="展开评论">▶</span>').append(g),e?(b.css("width",430),setEvCon(g,e,b,"comment",c,d)):$.ajax({url:siteUrl+"news/loadpoint/"+f+(stkCode?"/"+stkCode:""),dataType:"json"}).done(function(e){var h='<header class="capi-title">'+d.title+"</header>"+'<p class="time">'+"<time>"+e.time+"</time>来源："+e.from+'<a class="sina" href="javascript:;" title="分享到新浪" onclick="share(\''+d.title+"','"+siteUrl+"news/view/"+f+(stkCode?"/"+stkCode:"")+"')\"></a>"+'<a class="weixin" href="javascript:;" title="分享到微信" onclick="weixinCodeToggle(this)">'+'<img src="'+siteUrl+"captchas/qr?url=www.yuncaijing.com/touch/news/view/"+f+'" alt="">'+"</a>"+"</p>"+'<div class="content uglify-arcticle">'+e.description+"</div>"+"<footer>"+'以上内容已经经过压缩处理，查看全文请 &nbsp;<a href="'+e.source_url+'" target="_blank">点击这里</a>'+"</footer>";setEvCon(g,h,b,"comment",c,d),a.data("con",h)}).done(function(){})}function stkBigValFormat(a,b){var c=0;return a/=b||1,c=a>=1e8||-1e8>=a?MathRound(a/1e8)+"亿":a>=1e4||-1e4>=a?MathRound(a/1e4)+"万":MathRound(a)}function loadingLHB(a,b,c,d){var f,e=a.data("con");e?b.append(e):(f=$(GLOBAL.loadingSVG),b.append(f),$.ajax({url:siteUrl+"datacenter/coms_mingxi_modal/"+stkCode+"/"+a.data("data").requireTime+"/2",dataType:"json"}).done(function(e){var j,k,l,m,n,o,g="--",h=e.booksvr6,i='<div class="clearfix header"><span>净买金额：'+stkBigValFormat(1e4*e.netamount)+"</span>"+"<span>总买入金额："+stkBigValFormat(1e4*e.buyall)+"</span>"+"<span>总卖出金额："+stkBigValFormat(1e4*e.sellall)+"</span>"+"</div>";i+=e.increase<9?"<div>仅对涨幅大于9%的个股评级。</div>":h&&e.buyall<=1e3?"<div>当日龙虎榜成交额过低，不纳入席位短线、中线评级。</div>":'<div><small class="malign bold">席位短线评级：</small>'+rateLHBTit(h,e.star_t1,e.rank_t1)+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+'<small class="malign bold">席位中线评级：</small>'+rateLHBTit(h,e.star_t5,e.rank_t5)+"</div>",j=i+'<p class="bold sub-title">买入端</p>',k=e.com,l=[],m=[],n=[],o="--",e.lhb.forEach(function(a){var i,j,p,q,c=a.sig,d="未知",e=k[a.comcode].freq,f=k[a.comcode].type;"机构专用"==a.com?d="机构席位":f!=o&&(d=e!=o?("一般"==e?"不活跃":e)+"的"+f:f),i="<span>"+stkBigValFormat(1e4*a.netamount)+"</span>","sfl"==c&&(j=stkBigValFormat(1e4*a.buyamount),p=stkBigValFormat(1e4*a.sellamount),i='<span title="'+j+'">'+j+"</span>"+'<span title="'+p+'">'+p+"</span>"),q='<li class="clearfix"><span class="blue-text"><a class="msg-tooltip" href="'+siteUrl+"comd/index/"+a.url+'" data-original-title="" target="_blank" title="'+a.com+'">'+a.com+"</a></span>"+'<span title="'+(a.star_t1?a.rank_t1+"（"+a.star_t1.lv+"）":g)+'"><small class="malign">&nbsp;</small>'+rateLHB(h,a.star_t1)+"</span>"+'<span title="'+(a.star_t5?a.rank_t5+"（"+a.star_t5.lv+"）":g)+'"><small class="malign">&nbsp;</small>'+rateLHB(h,a.star_t5)+"</span>"+'<span title="'+d+'">'+d+"</span>"+i+"</li>","buy"==c?l.push(q):"sell"==c?m.push(q):n.push(q)}),j+='<div class="list"><ul><li class="clearfix bold-title"><span>营业部名称</span><span>短线评级</span><span>中线评级</span><span>资金类型</span><span>净额</span></li>'+l.join("")+"</ul></div>"+'<p class="bold sub-title">卖出端</p>'+'<div class="list"><ul>'+m.join("")+"</ul></div>",n.length&&(j+='<p class="bold sub-title">对倒</p><div class="list sfl"><ul><li class="clearfix bold-title"><span>营业部名称</span><span>短线评级</span><span>中线评级</span><span>资金类型</span><span>买入</span><span>卖出</span></li>'+n.join("")+"</ul></div>"),j='<div class="content capi-lhbang">'+j+"</div>",f.remove(),b.append(j),changeTop(b,c,d),a.data("con",j)}))}function createShow(a,b,c,d,e,f){function v(a,b){var c=(a+s).toFixed(1),e=(b+t).toFixed(1);d.attr("d","M0 0L"+c+" "+e)}var m,n,o,p,q,r,s,t,u,g=e.$WinWidth,h=e.$WinHeight,i=e.boxOffsetLeft,j=e.boxOffsetTop,k=e.translateX,l=e.translateY;switch(f){case 0:u="trade",e.lhb&&(u+=" capi-win-lhb");break;case 1:u="timeChart";break;case 2:u="evInfo";break;case 3:u="notice "+c.attr("id")}2==f?m=c.attr({"class":e.type?"capi-ev-timeInfo":"capi-evInfo",title:""}).html(""):(m=$("<div>").attr("class","capi-"+u),e.isMarket&&m.addClass("capi-market")),n=$("<i>").attr("class","capi-close").appendTo(m),2!=f&&m.append(a),1==f?loadingImg(m,b,h,e):2==f?(loadingArticle(c,m,h,e),$("#evt-"+m.attr("id").substring(4)).data("show",1)):"lhb"==b?loadingLHB(c,m,h,e):m.append(b),$BODY.append(m),o=m.outerWidth(),p=m.outerHeight(),q=i+k+10,r=j+l-40,q>g-o&&(q=i+k-o-10,e.loadingLeft=1),r>h-p&&(r=h-p-40),f||c.data("data")||m.css("width",o+1),m.css({left:q,top:r,zIndex:GLOBAL.zIndex}).capiDrag({move:function(a,b){v(a,b),!m.data("changeTop")&&m.data("changeTop",1)}}),s=.4*o-i-k,t=.36*p-j-l,v(q,r),n.on("click.charts",function(){2==f?(c.attr({"class":"capi-evIcon capi-transition",title:e.title}).css({left:e.oldLeft,top:e.oldTop,zIndex:9,height:"auto",width:"20px"}).html(e.oldHtml),d.attr("d",e.oldDragLine_d),$("[data-capi-evt="+m.attr("id").substring(4)+"]").data("show",0),e.type&&c.attr("class","capi-ev-timeIcon capi-transition")):(m.add(d).remove(),c.data("show",0),v=null,3==f&&$("[data-capi-notice="+c.attr("id").substring(7)+"]").data("show",0)),s=t=null}),m.on("dblclick.charts",function(a){"capi-gly-com"!=a.target.getAttribute("class")&&"textarea"!=a.target.tagName.toLowerCase()&&n.trigger("click.charts")})}function createTimeShow(a,b,c){var d=c.stock[1],e=c.time,f='<header class="capi-title"><span>'+c.stock[0]+"("+d+") 分时图</span>"+"<time>"+e+"</time>"+"</header>",g="http://www.yuncaijing.com/stock/paintline/"+d+"/"+e;createShow(f,g,a,b,c,1)}function createTradeShow(a,b,c,d,e){var h,i,f=a.data("data"),g=[];b?(b="大宗",f.big.forEach(function(a){g.push('<div class="content"><p>成交价格：'+a.price+" &nbsp;&nbsp; 成交量："+a.vol+" &nbsp;&nbsp; 成交金额："+a.sum+"</p>"+'<p>买方营业部：<a target="_blank" href="'+siteUrl+"comd/index/"+a.buyerUrl+'">'+a.buyer+"</a></p>"+'<p>卖方营业部：<a target="_blank" href="'+siteUrl+"comd/index/"+a.vendorUrl+'">'+a.vendor+"</a></p>"+"</div>")})):e||(b="内部",f.buy?f.buy.forEach(function(a){g.push("<p>"+a+"</p>")}):f.sell.forEach(function(a){g.push("<p>"+a+"</p>")}),g=['<div class="content">'+g.join("")+"</div>"]),e?(i='<header class="capi-title">'+f.time+"龙虎榜数据："+f.title+"</header>",h="lhb"):(i='<header class="capi-title">'+f.time+" "+b+"交易数据</header>",h=g.join("")),createShow(i,h,a,c,d,0)}function Timechart(a,b){return this.settings(a,b),this}function timeMove(a,b){var k,l,m,n,o,p,c=a.oneSpaceWidth,d=a.box,e=a.boxOffsetLeft,f=a.color.dot,g=a.title.find("tspan"),h=a.main.appendSE("g"),i=h.appendSE("rect",{x:0,y:30,width:a.svgWidth,height:a.svgHeight-50,fill:"transparent"}),j=h.appendSE("circle",{cx:0,cy:0,r:4,fill:f,visibility:"hidden"});a.settings.hasBar&&(k=h.appendSE("circle",{cx:0,cy:0,r:4,fill:f,visibility:"hidden"}),l=a.gradientHeight+30),$WIN.on("resize.timechart",throttle(function(){var a=d.offset();e=a.left},100)),m=a.lineCoord,"time"==b?n=WIN.syncChartsData.time:(o=a.settings.xAxis,p=a.data),i.on("mousemove",function(d){var f=MathRound((d.pageX-e)/c),h=m.x[f];h!=UNDEFINED?(j.attr({cx:h,cy:m.y[f],visibility:"visible"}),k&&k.attr({cx:h,cy:a.barYCoord[f]+l,visibility:"visible"}),"time"==b?(p=n.series.data,g.eq(1).text(n.xAxis[f]),g.eq(3).text(p[f][0]),g.eq(5).text(formatVol(p[f][1])),g.eq(7).text(p[f][2]+"%")):(g.eq(1).text(o[f]),g.eq(2).text(p[f]))):i.trigger("mouseout")}).mouseout(function(){[j,k].forEach(function(a){a&&a.attr("visibility","hidden")})})}function createIcon(a,b){var c=a.lineCoord,d=c.x,e=c.y,f=a.boxOffsetLeft,g=a.boxOffsetTop,h=a.dragG,i=a.settings.series.icon,j=[];i.forEach(function(a,c){a.name.forEach(function(a,k){var p,l=i[c].index,m=d[l],n=e[l],o=10+18*k;h.appendSE("path",{id:"capi-ev-"+a,d:"M0 0 0 -"+o,transform:"translate("+m+","+n+")"}),p=createEvIcon({boxOffsetLeft:f,boxOffsetTop:g,iconHtml:a,title:i[c].title[k],nid:i[c].nid[k],iconInSvgleft:m-10,iconInSvgTop:n-o-19},b),j.push(p)})}),$BODY.append(j.join(""))}function Evtlinechart(a,b){this.settings(a,b)}var textColor,rateLHB,rateLHBTit,$=jQuery,UNDEFINED=void 0,WIN=window,DOC=document,$WIN=$(WIN),$DOC=$(DOC),$BODY=$("body"),MATH=Math,MathRandom=MATH.random,MathRound=MATH.round,MathFloor=MATH.floor,MathCeil=MATH.ceil,MathMax=MATH.max,MathMin=MATH.min,MathAbs=MATH.abs,MathSqrt=MATH.sqrt,SVG={ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"},Browser=function(){var a=navigator.userAgent.toLowerCase();return{ff:-1!=a.indexOf("firefox")?1:0,ie:-1!=a.indexOf("trident")?1:0}}(),global_loadingImg='<img src="'+siteUrl+'templates/default/assets/image/charts/loading.gif" alt="">',GLOBAL={color:{gray:"#f0f0f0",black:"#000"},zIndex:9,loadingHtml:'<div class="capi-loading">'+global_loadingImg+"</div>",loadingSVG:'<div class="capi-loading-svg">'+global_loadingImg+"<i></i></div>"};WIN.chartsUpdate=function(a){var b=a.time,c=WIN.syncChartsData;b!=c.lastTime&&(c.lastTime=b,b>="15:00"&&($("svg circle.capi-dynamic").remove(),$("svg .capi-dynamic").removeAttr("class"),c.time.flash=c.k.flash=0),GLOBAL.Kchart.update(a),GLOBAL.Timechart.update(a))},WIN.changeKChartBottom=function(a){GLOBAL.Kchart.changeBottom(a)},Linechart.prototype={init:function(a,b){var i,j,k,l,c=$.extend(!0,{style:{font:'12px "\\5FAE\\8F6F\\96C5\\9ED1"',overflow:"hidden","box-sizing":"border-box",padding:"10px"},dataType:"common",title:"指数",xAxis:[],series:[]},b),d=a.appendSE("svg",{width:"100%",height:"100%",xmlns:SVG.ns}).css(c.style),e=d.width(),f=d.height(),g=pInt(d.css("font-size")),h=[];return Browser.ff&&(e=e-pInt(d.css("paddingLeft"))-pInt(d.css("paddingRight")),f=f-pInt(d.css("paddingTop"))-pInt(d.css("paddingBottom"))),10>e||80>f?(d.remove(),a.text("屏幕太小无法显示")):(c.series.forEach(function(a,b){h.push(b)}),j=createSE("g").attr("class","capi-main"),i=c.xAxis.length,k=createTitle(g,j,[c.title,c.xAxis[i-1],c.series[0].title&&c.series[0].title[i-1]||""]),l=this,l.global={box:a,svg:d,settings:c,svgWidth:e,svgHeight:f,fontSize:g,serIndex:h,xLength:i,main:j,title:k,add:function(a){return $.extend(this,a),l}},l.grid().line().xAxis().flag().hover(),d.append(j),void 0)},grid:function(){var k,l,m,n,o,q,r,s,u,v,w,x,y,z,A,a=this,b=a.global,c=b.main,d=b.svgWidth,e=.5*b.fontSize,f=b.settings,g=f.series,h=b.svgHeight-50,i=h-30,j={gray:"#f0f0f0",black:"#000"},p=4,t=[];for(g.forEach(function(a){t.push(a.data)}),u=yAxis(arrMaximin(t),i),v=u.max,w=u.min,x=u.oneMean,y=u.yNum,z=u.yOneSize,A=u.DValue,k=arrMax([v.toFixed(2).length,w.toFixed(2).length]),l=k*e+8,m=.6*f.xAxis[0].length*e,o=MathRound(l-m>0?l:m),n=d-o,c.attr("transform","translate("+o+",0)");p--;){switch(p){case 0:q="M0 .5L"+n+" .5";break;case 1:q="M0 "+(h-.5)+"L"+n+" "+(h-.5);break;case 2:q="M"+(n-.5)+" 0L"+(n-.5)+" "+h;break;case 3:q="M.5 0L.5 "+h}c.appendSE("path",{d:q,stroke:p%2?j.black:j.gray})}return r=c.appendSE("g",{"class":"capi-bgline"}),createBgLine(r,y,z,n),s=initYText(c,y,z,v,x,e,"hotEvent"==f.dataType?1:0,{min:u.min,yHeight:i,bgline:r,mainWidth:n}),b.add({xTextWidth:2*m,translateX:o,mainWidth:n,mainHeight:h,bgline:r,yNum:y,yHeight:i,yAxisG:s,DValue:A,max:v,min:w,color:j})},line:function(){var p,q,r,b=this.global,c=b.main,d=b.mainWidth,e=b.mainHeight,f=b.DValue,g=b.max,h=b.settings,i=h.series,j=(.1*b.fontSize).toFixed(1),k=["#F15C80","#90ED7D","#7CB5EC","#E5D55E","#8085E8","#91E8E1","#F7A35C","#8D4653","#74be6d","#be6da2"],l=createSE("g").attr({"class":"capi-line",fill:"none"}),m=createSE("g").attr({"class":"capi-dot"}),n=[],o=[];return i.forEach(function(a){o.push(a.data.length)}),p=arrMax(o),q=d/(p-1),r=.01*((e-30)/f),i.forEach(function(a,b){var c=[],d=0,f=a.width?MathAbs(a.width):j,h=a.color?a.color:k[b]?k[b]:randomColor(),i=m.appendSE("g",{fill:h}).data("index",b);n.push(h),a.data.forEach(function(a,b){if(a||"0"==a){var h,j=MathFloor(q*b)+.5,k=MathFloor((100*g-100*a)*r)+29.5;isNaN(k)&&(k=.1*e),h=d?"L":"M",d=1,c.push(h+j+" "+k)}else d=0;i.appendSE("circle",{cx:j?j:0,cy:k?k:-999,r:j?(3*f).toFixed(2):0})}),l.appendSE("path",{d:c.join(""),stroke:h,"stroke-width":f})}),"hotEvent"==h.dataType?c.append(l):c.append(l,m),b.add({lineG:l,dotG:m,maxLen:p,oneLineWidth:q,colorStore:n})},xAxis:function(){function l(a){return MathFloor(MathRound(a*j/i)*i)+.5}var n,o,p,q,r,a=this,b=a.global,c=b.svgHeight,d=b.settings.xAxis,e=b.color,f=b.fontSize,g=b.main,i=(b.mainWidth,b.oneLineWidth),j=b.mainWidth/3,k=createSE("g").attr({"class":"capi-xaixs",transform:"translate(0,"+(c-50)+")","text-anchor":"middle"}),m="hotEvent"==b.settings.dataType;for(m&&(k.appendSE("path",{d:"M"+l(1)+" -.5v-"+(c-80),stroke:"#ccc","stroke-dasharray":6}),k.appendSE("path",{d:"M"+l(2)+" -.5v-"+(c-80),stroke:"#ccc","stroke-dasharray":6})),n=0;4>n;n++)o=MathRound(n*j/i),p=MathFloor(o*i)+.5,q=d[o],n&&k.appendSE("path",{d:"M"+p+" -.5v-4",stroke:e.black}),r=k.appendSE("text",{x:p,y:(1.14*f).toFixed(1)}),0==n&&r.attr("text-anchor","start"),3==n&&r.attr("text-anchor","end"),m&&(q=2==n?d[o+1].substring(0,5):3==n?"":q.substring(0,5)),r.text(q);return g.append(k),a},flag:function(){function p(a){return MathCeil(f/a)}var a=this,b=a.global,c=b.svgWidth,d=b.svgHeight,e=b.colorStore,f=b.fontSize,g=b.settings.series,h=b.lineG,i=b.dotG,j=b.main,m=(b.mainWidth,b.oneLineWidth,b.translateX),n=createSE("g").attr({"class":"capi-flag",transform:"translate(0,"+(d-f/2-15)+")",cursor:"pointer"}),o=[[],[]];return g.forEach(function(a,c){var g,i,h,d=a.name;"hotEvent"==b.settings.dataType&&(g=a.data[a.data.length-1]?"："+a.data[a.data.length-1]:"    ",d+=g),h=n.appendSE("g").data("index",c),h.appendSE("path",{d:"M0 "+p(3)+"L"+p(.6)+" "+p(3)+"L"+p(.6)+" "+p(2)+"L0 "+p(2)+"ZM"+p(2.4)+" 0L"+p(.8)+" 0L"+p(.8)+" "+p(1.2)+"L"+p(2.4)+" "+p(1.2)+"Z",fill:e[c]}),h.appendSE("text",{x:p(.5),y:p(1.2)}).text(d),i=p(.5)+d.length*f,o[0].push(h),o[1].push(i)}),x=(c-(arrSum(o[1])+10*(o[1].length-1)))/2-m,o[0].forEach(function(a,b){b&&(x+=o[1][b-1]+10),a.attr("transform","translate("+x+",0)")}),n.on("click","g",throttle(function(){var c=$(this),d=c.data("index"),f=c.data("gray"),g=$("path",c),j=$("text",c),k=b.serIndex;f?(g.attr("fill",e[c.index()]),j.attr("fill","#000"),$("path:eq("+d+")",h).attr("visibility","visiable"),$("g:eq("+d+")",i).attr("visibility","visiable"),b.serIndex.push(d),b.serIndex.sort()):(g.add(j).attr("fill","#ccc"),$("path:eq("+d+")",h).attr("visibility","hidden"),$("g:eq("+d+")",i).attr("visibility","hidden"),b.serIndex=k.filter(function(a){return a==d?0:1})),a.draw(d),c.data("gray",!f)},0,200)),j.append(n),a},draw:function(a){function e(a,b){var c=arrMaximin(a);return c.max>=b.max||c.min<=b.min?1:0}var h,f,g,i,j,k,l,b=this,c=this.global,d=c.serIndex;d[0]!==UNDEFINED&&(f=c.settings.series,g=[],d.forEach(function(a){g.push(f[a&&a].data)}),h=arrMaximin(g),e(f[a].data,h)&&(i=drawYText(c.yAxisG,h,c.yHeight,c.fontSize,"hotEvent"==c.settings.dataType?"hotEvent":"",{min:h.min,yHeight:c.yHeight,bgline:c.bgline,mainWidth:c.mainWidth}),j=i.yNum,k=i.yOneSize,l=c.bgline,j!=c.yNum&&($("g",l).remove(),createBgLine(l,j,k,c.mainWidth),c.yNum=j),b.drawLine(g,d,i.max,i.DValue)))},drawLine:function(a,b,c,d){var l,m,e=[],f=[],g=this.global,h=g.lineG,i=g.dotG,j=g.oneLineWidth,k=.01*((g.mainHeight-30)/d);a.forEach(function(a){var b=[],d=[],g=[],h=0;a.forEach(function(a,e){if(a||"0"==a){var f,i=MathFloor(j*e)+.5,l=MathFloor((100*c-100*a)*k)+29.5;f=h?"L":"M",h=1,g.push(f+i+" "+l)}else h=0;b.push(i?i:0),d.push(l?l:-999)}),e.push(g.join("")),f.push({cx:b,cy:d})}),l=$("path",h),m=$("g",i),b.forEach(function(a,b){l.eq(a).attr("d",e[b]),m.eq(a).find("circle").each(function(a){$(this).attr({cx:f[b].cx[a],cy:f[b].cy[a]})})})},hover:function(){var a=this,b=a.global,c=b.svg,d=function(a,b){function u(a,c){for(var j,k,n,o,d=MathRound(c.pageY-l.top-m.top),e=[[],[]],g=0,h=b.serIndex,i=h.length;i>g;g++)j=$("g",q).eq(h[g]),k=$("circle:eq("+a+")",j),k.length&&(e[0].push(k),e[1].push(MathAbs(d-k.attr("cy"))));n=e[1].indexOf(arrMin(e[1])),-1!=n&&(s.dot?(s.dot.attr("r",s.r),s.dot=e[0][n]):(s.dot=e[0][n],s.r=s.dot.attr("r")),s.dot.attr("r",2*s.r),o=f[h[n]].title[a],r.eq(2).text(o?o:""))}function v(a){for(var b=0;4>b;b++)f[b]&&f[b].data[a]?p.eq(b).text(f[b].name+"："+f[b].data[a]+"%"):p.eq(b).text(f[b]?f[b].name:"")}var t,c=b.settings,d="hotEvent"==c.dataType?1:0,e=c.xAxis,f=c.series,g=b.main,h=b.mainWidth,i=b.mainHeight-30,j=g.appendSE("rect",{width:h,height:i,fill:"transparent",transform:"translate(0,30)"}),k=b.box,l=k.offset(),m={left:pInt(a.css("paddingLeft")),top:pInt(a.css("paddingTop"))},n=b.oneLineWidth,p=((n/2).toFixed(2),a.find(".capi-flag text")),q=b.dotG,r=b.title.find("tspan"),s={};$WIN.on("resize.Linechart",throttle(function(){l=k.offset()},100)),j.on("mousemove",throttle(function(a){var c,f,h;t||(t=g.appendSE("path",{"class":"capi-tipline",d:"M0 0 0 "+i,stroke:b.color.black}),d||q.before(t)),c=a[0],f=MathRound((c.pageX-l.left-m.left-b.translateX)/n),d?v(f):u(f,c),h=e[f],r.eq(1).text(h?h:""),t.attr({visibility:"visible",transform:"translate("+(MathFloor(n*f)+.5)+",30)"})},0,52)).mouseout(function(){t&&t.attr("visibility","hidden")})};c.on("mouseover.charts",function(){d(c,b),$(this).off("mouseover.charts")})}},$DOC.on("click.evInfo",".capi-gly-com",throttle(function(){var c,d,a=$(this),b=a.data("show");c=a.parents(".capi-ev-timeInfo").length?a.parents(".capi-ev-timeInfo"):a.parents(".capi-evInfo"),b?(c.find(".capi-comment").remove(),c.css("width",430),a.html("▶").attr("title","展开评论")):(d=$("<div>").attr("class","capi-comment fl").append(GLOBAL.loadingSVG),c.append(d).css("width",654),a.html("◀").attr("title","收起评论"),getComment(a.attr("data-nid"),d)),a.data("show",!b)},0,100)),textColor=function(){var a="red-text",b="green-text",c="black-text";return function(d){return d>0?a:0==d?c:b}}(),rateLHB=function(){var a="--";return function(b,c){var e,d="";if(c){if(c.full)for(e=0;e<c.full;e++)d+='<mark class="full-star"></mark>';if(c.halffull)for(e=0;e<c.halffull;e++)d+='<mark class="halffull-star"></mark>';if(c.hollow)for(e=0;e<c.hollow;e++)d+='<mark class="hollow-star"></mark>'}else d=a;return d}}(),rateLHBTit=function(a,b,c){return a?'<span class="bold" title="'+c+'">'+rateLHB(a,b)+'<i class="red-text">（'+(b?b.lv:"--")+"）</i></span>":'<a href="'+siteUrl+'apply/app_details/10" target="_blank">需购买高级席位数据（新）</a>'},Kchart.prototype={init:function(box,Options){var xLength,xInLen,main,title,_this,hasBar,settings=$.extend(!0,{style:{font:'12px "\\5FAE\\8F6F\\96C5\\9ED1"',overflow:"hidden","box-sizing":"border-box"},title:"K线图(日)",stock:[],dynamic:0,hasBar:0,xAxis:[],series:{}},Options),svg=box.appendSE("svg",{width:"100%",height:"100%",xmlns:SVG.ns}).css(settings.style),svgWidth=svg.width(),svgHeight=svg.height(),yHeight=svgHeight-50,fontSize=pInt(svg.css("font-size"));if(10>svgWidth||80>svgHeight)return svg.remove();with(main=createSE("g").attr("class","capi-main"),xLength=settings.xAxis.length,xInLen=xLength-1,data=settings.series.data,title=createTitle(fontSize,main,[settings.title,settings.xAxis[xInLen],"开：",data[xInLen][0],"高：",data[xInLen][1],"低：",data[xInLen][2],"收：",data[xInLen][3],"量：",formatVol(data[xInLen][4]),"幅：",data[xInLen][5]]),_this=this,_this.global={box:box,svg:svg,settings:settings,svgWidth:svgWidth,svgHeight:svgHeight,yHeight:yHeight,fontSize:fontSize,xLength:xLength,xInLen:xInLen,main:main,title:title,kColor:{gray:"#ccc"},add:function(a){return $.extend(this,a),_this}},_this)hasBar=settings.hasBar,grid(),createMaTitle(),kInit(),xAxis(),createK(),ma(),trade(),notice(),hasBar&&bar(),hasBar&&chartBottom(),dynamic(),hover(),maClick(),icon(),tradeClick(),kClick(),noticeClick();return svg.append(main),_this},grid:function(){var g,h,a=this.global,b=a.settings.series,c=a.main,d=a.svgWidth,e=b.data,f=[];return e.forEach(function(a){f.push(a[1]),f.push(a[2])}),g=arrMaximin([f,b.ma5,b.ma10,b.ma20,b.ma30]),h=c.appendSE("g",{stroke:a.kColor.gray,"stroke-dasharray":6}),function(b){for(var g,h,c=MathFloor(a.yHeight/50),e=MathFloor(a.yHeight/c),f=0;c>f;f++)g=addPointFive(f*e)+29,h=b.appendSE("path",{d:"M1 "+g+"L"+d+" "+g}),f||h.attr("stroke-dasharray",0)}(h),a.add({bgline:h,max:g.max,min:g.min})},createMaTitle:function(){var a=this,b=a.global,c=b.settings.series,d=b.xInLen,e=["#E96D6D","#36A3DC","#C9A811","#1966AE"],f=["MA5：",c.ma5[d],"MA10：",c.ma10[d],"MA20：",c.ma20[d],"MA30：",c.ma30[d]],g=a.modal_bottomTit(b.main,e,f);return g.textElem.attr("y",46),b.add({maTitle:g.textElem,allMaTspan:g.allTspan,maColor:e})},xAxis:function(){var l,o,p,q,m,n,a=this,b=a.global,c=b.main,d=b.bgline,e=b.svgHeight,f=b.halfOneKWidth,g=b.settings.xAxis,i=(b.fontSize,b.kColor.gray),j=e-19.5,k=createSE("g").attr("transform","translate(0,"+j+")");for(k.appendSE("path",{d:"M0 0 "+b.svgWidth+" 0",stroke:i}),l=k.appendSE("g",{transform:"translate(0,14)"}),m=MathRound(b.xLength/3),n=0;4>n;n++){switch(n){case 0:o=0,q=g[0],p="start";break;case 3:o=b.svgWidth,q=g[b.xInLen],p="end";break;default:o=b.kx(m*n)+f,q=g[m*n],p="middle",d.appendSE("path",{d:"M"+o+" 29.5 "+o+" "+j})}l.appendSE("text",{x:o,"text-anchor":p}).text(q?q:"")}return c.append(k),a},kInit:function(){var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,a=this.global,b=a.svgHeight,c=a.svgWidth,d=a.settings.series,e=d.trade,f=d.data,g=a.max,h=a.min,i=b-70,j=50,k=.76*c/a.xLength,l=.24*c/a.xInLen;return k>20&&(k=20),l>16&&(l=16),a.settings.hasBar&&(a.settings.indexType!=UNDEFINED?(q=.2*i,o=.2*i,i*=.6):(o=.22*i,i*=.78)),d.notice[0]&&(r=k+2,i-=r,j+=r),p=function(){var a=i/(g-h);return function(b){return MathFloor((g-b)*a)}}(),m=MathFloor(k/2),n=(.1*MathCeil(k)).toFixed(2),e[0]&&(s=[[],[]],e.forEach(function(a){var b=0,c=0;a.buy&&b++,a.sell&&b++,c=6*b*n,a.big&&(b++,c+=8*n),a.lhbang&&(b++,c+=10*n),s[0].push(a.index),s[1].push(5*b+c)}),t=[],s[0].forEach(function(a){t.push(p(f[a][2]))}),u=[],t.forEach(function(a,b){u.push(a+s[1][b])}),u=arrMax(u),v=u-i,v>0&&(i-=v)),e[0]&&(p=function(){var a=i/(g-h);return function(b){return MathFloor((g-b)*a)}}()),w=a.bgline.appendSE("g",{stroke:"#333","stroke-dasharray":0}),x=a.box,y=x.offset(),z={width:$WIN.width(),height:$WIN.height()},$WIN.on("resize.Kchart",throttle(function(){var a=x.offset();y.left=a.left,y.top=a.top,z.width=$WIN.width(),z.height=$WIN.height()},100)),A=MathFloor(j+i+(v>0?v:0)),a.add({offset:y,$winSet:z,dragLineG:w,chartBottomHeight:q,barTranslateY:A,barHeight:o,kTranslateY:j,kHeight:i,oneKWidth:k,halfOneKWidth:m,oneSpaceWidth:l,tradeScale:n,k:f,ky:p,kx:function(a){return addPointFive((k+l)*a)}})},createK:function(){function q(a,b,c,d,e,f,i){var m=j(b)-.5,n=o.appendSE("g",{transform:"translate("+m+",0)",fill:f});return c=MathFloor(c),d=MathFloor(d),n.appendSE("rect",{x:h,y:c,width:1,height:e}),n.appendSE("rect",{x:0,y:MathFloor(l+k(a)),width:g,height:MathAbs(k(i[0])-k(i[3]))||1}),n.appendSE("rect",{x:0,y:c,width:g,height:e,fill:"transparent"}),p.x.push(m),p.topY.push(c),p.lowY.push(d),n}var a=this.global,b=a.main,g=(a.xInLen,a.svgHeight,a.settings.xAxis,a.fontSize,MathCeil(a.oneKWidth)),h=a.halfOneKWidth,j=(a.oneSpaceWidth,a.kx),k=a.ky,l=a.kTranslateY,n=(a.kHeight,{red:"#DD2200",green:"#33AA11",list:[]}),o=createSE("g").attr("cursor","pointer"),p={x:[],topY:[],lowY:[]};return a.k.forEach(function(a,b){var g,h,c=l+k(a[1]),d=l+k(a[2]),e=MathAbs(c-d),f=a[0]-a[3];f>0?(g=n.green,h=q(a[0],b,c,d,e,g,a)):0>f?(g=n.red,h=q(a[3],b,c,d,e,g,a)):(g="+"==a[5].charAt(0)?n.red:n.green,h=q(a[0],b,c,d,e,g,a)),n.list.push(g)}),b.append(o),a.add({kCoord:p,kColor:n,halfOneKWidth:h,kG:o})},ma:function(){var n,k,l,m,o,a=this,b=a.global,c=b.kTranslateY,d=b.ky,e=b.kCoord.x,f=b.halfOneKWidth,g=b.maColor,h=b.settings.series,i=[h.ma5,h.ma10,h.ma20,h.ma30],j=b.main.appendSE("g").attr("fill","none");for(k=0,l=i.length,m=[],o=[];l>k;k++)m.length=0,i[k].forEach(function(a,b){var g=d(a)+c;m.push(b?"L"+(e[b]+f)+" "+g:"M"+f+" "+g)}),n=j.appendSE("path",{"class":"capi-kline",d:m.join(""),stroke:g[k]}),o.push(n);return b.add({allMa:i,allMaPath:o})},maClick:function(){function i(a,b){d[a].attr("fill",g),d[b].attr("fill",g)}function j(a,b,c){d[a].attr("fill",c),d[b].attr("fill",c)}function k(a,b,c){return h[a]?j(b,c,f[a]):i(b,c),a}var a=this,b=a.global,c=b.maTitle,d=b.allMaTspan,e=b.allMaPath,f=b.maColor,g="#ccc",h={0:0,1:0,2:0,3:0};return c.on("click","tspan",throttle(function(){var a,b;switch($(this).index()){case 0:case 1:a=k(0,0,1);break;case 2:case 3:a=k(1,2,3);break;case 4:case 5:a=k(2,4,5);break;case 6:case 7:a=k(3,6,7)}b=h[a],e[a].attr("visibility",b?"visible":"hidden"),h[a]=!b},0,200)),a},trade:function(){function n(a,b,c,d,g,h,i){var p,o,n=f[b]+6*d*k+5*d+5;return i&&(n=MathFloor(n+3*k-1)),o={transform:"translate("+e[b]+","+n+") scale("+k+")"},a?(p="circle",o=$.extend(o,{cx:5,cy:5,r:3,fill:"#fff",stroke:"#DD2200","stroke-width":2,id:"tj-bigTrade"})):(p="path",o.fill=c,0===a?(o.d=l,o.id="tj-insidertrade"):(o.d=m,o.stroke="rgba(0,0,0,0)",o.id="tj-lhb")),j.appendSE(p,o).data("data",g).appendSE("title").text(h),++d}var a=this,b=a.global,c=b.main,d=b.kCoord,e=d.x,f=d.lowY,g=b.kColor,h=g.red,i=g.green,j=c.appendSE("g",{"class":"capi-flag",cursor:"pointer"}),k=b.tradeScale,l="M5 0 10 6 0 6",m="M5 0 10 5 5 10 0 5zM5 1 1 5 5 9 9 5zM5 3 7 5 5 7 3 5z",o=b.settings.xAxis;return b.settings.series.trade.forEach(function(a){var b=0,c=a.index,d=a.time,e=a.buy,f=a.sell,g=a.big,j=a.lhbang,k=0;e&&(b=n(0,c,h,b,{time:d,buy:e},"【内部交易数据】"+e[0]+addEllipsis(e[1]))),f&&(b=n(0,c,i,b,{time:d,sell:f},"【内部交易数据】"+f[0]+addEllipsis(f[1]))),g&&(b=n(1,c,h,b,{time:d,big:g,buyerUrl:a.buyerUrl,vendorUrl:a.vendorUrl},"【大宗交易数据】成交价格："+g[0].price+" 成交量："+g[0].vol+" 成交金额："+g[0].sum+addEllipsis(g[1])),k=1),j&&n(!1,c,h,b,{requireTime:o[c],time:d,title:j,lhb:1},"【龙虎榜数据】"+d+" "+j,k)}),b.add({tradeG:j})},notice:function(){var d,e,f,g,a=this,b=a.global,c=b.settings.series.notice;return c[0]?(d=b.main.appendSE("g",{"class":"capi-flag",transform:"translate(0, 50)",fill:b.kColor.red,cursor:"pointer"}),e="M5 0 10 5 5 10 0 5",f=b.kCoord.x,g=b.tradeScale,c.forEach(function(a){var b=d.appendSE("path",{id:"notice-"+a.index,d:e,transform:"translate("+f[a.index]+",0) scale("+g+")"}),c=a.text[0].title;b.appendSE("title").text("【公司公告】"+c+addEllipsis(a.text[1]))}),b.add({noticeG:d,notice:c})):a},bar:function(){var l,m,a=this,b=a.global,c=b.k,d=b.kCoord.x,e=b.kColor.list,f=MathCeil(b.oneKWidth),g=b.barHeight,h=b.main.appendSE("g",{transform:"translate(0,"+b.barTranslateY+")"}),i=.9*g,j=.1*g,k=[];return h.appendSE("path",{d:"M0 .5 "+b.svgWidth+" .5",stroke:"#ccc"}),c.forEach(function(a){k.push(a[4])}),m=arrMaximin(k),l=function(){var a=i/m.max;return function(b){return MathFloor(b*a)}}(),c.forEach(function(a,b){var c=l(a[4]);h.appendSE("rect",{x:d[b],y:MathFloor(i-c+j),width:f,height:c,fill:e[b]})}),b.add({volG:h,maxVol:m.max,minVol:m.min,volHCalc:l,volBarHeight:i,volSpaceHeight:j})},createKChartIndex:function(a){var b=this,c=b.global,d=["Market","Macd","Kdj","Rsi"];switch(+a){case 1:method=d[1];break;case 2:method=d[2];break;case 3:method=d[3];
break;default:method=d[0]}b[method.toLowerCase()](),d.forEach(function(a){c["has"+a]=0}),c["has"+method]=1},chartBottom:function(){if(this.global.settings.indexType!=UNDEFINED){var a=this.global,b=a.chartBottomHeight,c=a.main.appendSE("g",{transform:"translate(0,"+addPointFive(a.svgHeight-b-20)+")"});c.appendSE("path",{d:"M0 0 "+a.svgWidth+" 0",stroke:"#ccc"}),a.add({chartBottomG:c}).createKChartIndex(a.settings.indexType)}},market:function(){var l,m,n,o,p,q,r,s,a=this.global,b=a.chartBottomHeight,c=a.kCoord.x,d=a.halfOneKWidth,e=WIN.syncChartsData.k.series.market,f=e.data,g=e.event,h="#173070",i=a.chartBottomG.appendSE("g"),j=i.appendSE("g",{fill:"#fff",stroke:h}),k=a.xInLen;marketTitle=createTitle(6,i,["市场关注度",a.settings.xAxis[k],f[k]]),l=arrMaximin(f),m=l.max,n=function(){var a=(b-30)/(m-l.min);return function(b){return MathFloor((m-b)*a)}}(),o="",p=[],q=[],f.forEach(function(a,b){var g,e=c[b]+d,f=n(a)+24;o+=(o?" ":"M")+e+" "+f,g=j.appendSE("circle",{cx:e,cy:f,r:2}),g.appendSE("title").text("市场关注度："+a),q.push(g),p.push(f)}),i.appendSE("path",{d:o,fill:"none",stroke:h,"stroke-width":2}).after(j),g.length&&(r=i.appendSE("g",{"class":"capi-market-red",fill:"#DD2200",cursor:"pointer"}),s=4.6*(a.svgWidth/766),s>6.5&&(s=6.5),3.5>s&&(s=3.5),g.forEach(function(a){q[a.index].attr("r",s).appendTo(r)})),a.add({marketTitle:marketTitle}).marketClick(r,p)},dynamic:function(){var a=this,b=a.global;return b.settings.dynamic&&($("g:last",b.kG).attr("class","capi-dynamic"),b.volG&&$("rect:last",b.volG).attr("class","capi-dynamic")),a},hover:function(){var p,a=this.global,b=a.settings.xAxis,c=WIN.syncChartsData.k.series,d=a.allMa,e=$("tspan",a.title),f=a.allMaTspan,g=a.offset,h=a.kCoord.x,i=a.halfOneKWidth,j=a.oneKWidth+a.oneSpaceWidth,k=a.main,l=a.volG,m=a.bgline,n=a.svgHeight-50,o=k.appendSE("rect",{x:0,y:30,width:a.svgWidth,height:n,fill:"transparent"});m.after(o),l&&m.after(l),o.mousemove(throttle(function(l){function z(a,b,c,d){a[1].text(b),a[3].text(c),a[5].text(d)}var o,q,r,s,t,u,v,w,x,y;if(!p&&(p=k.appendSE("path",{d:"M0 0 0 "+n,stroke:"#666","stroke-dasharray":0}),m.after(p)),o=MathFloor((l[0].pageX-g.left)/j),q=h[o],q!=UNDEFINED){for(p.attr({visibility:"visible",transform:"translate("+(q+i+.5)+",30)"}),r=c.data,e.eq(1).text(b[o]),e.eq(3).text(r[o][0]),e.eq(5).text(r[o][1]),e.eq(7).text(r[o][2]),e.eq(9).text(r[o][3]),e.eq(11).text(formatVol(r[o][4])),e.eq(13).text(r[o][5]),s=0,t=1;4>s;s++,t+=2)f[t].text(d[s][o]);a.hasMarket?(u=a.marketTitle.find("tspan"),v=c.market.data,u.eq(1).text(b[o]),u.eq(2).text(v[o])):a.hasMacd?(w=c.macd,z(a.macdAllTspan,w.dif[o],w.dea[o],w.bar[o])):a.hasKdj?(x=c.kdj,z(a.kdjAllTspan,x.k[o],x.d[o],x.j[o])):a.hasRsi&&(y=c.rsi,z(a.rsiAllTspan,y.rsi6[o],y.rsi12[o],y.rsi24[o]))}},0,32)).mouseout(function(){p&&p.attr("visibility","hidden")}),k.on("mouseover",".capi-kline",function(){$(this).attr("stroke-width",3)}).on("mouseout",".capi-kline",function(){$(this).attr("stroke-width",1)})},icon:function(){var a=this.global,b=a.offset,c=a.halfOneKWidth,d=a.kCoord,e=d.x,f=d.topY,g=a.dragLineG,h=a.settings.series.icon,i=[];h.forEach(function(a,d){a.name.forEach(function(a,j){var o,k=h[d].index,l=e[k]+c+.5,m=f[k],n=10+18*j;g.appendSE("path",{id:"capi-ev-"+a,d:"M0 0 0 -"+n,transform:"translate("+l+","+m+")"}),o=createEvIcon({boxOffsetLeft:b.left,boxOffsetTop:b.top,iconHtml:a,title:h[d].title[j],nid:h[d].nid[j],iconInSvgleft:l-10,iconInSvgTop:m-n-19}),i.push(o)})}),$BODY.append(i.join(""))},tradeClick:function(){function h(a,b){if(!a.data("show")){var l,h="circle"==b?1:0,i=a.attr("transform"),j=+i.replace(/.+\((.+)[,| ]\d.+/,"$1")+f+.5,k=+i.replace(/.+[,| ](\d.+)\).+/,"$1")+(h?5:3)*g;a.data("data").lhb&&(k+=2*g),l=c.appendSE("path",{d:"M0 0 0 0",transform:"translate("+j+","+k+")"}),createTradeShow(a,h,l,{$WinWidth:e.width,$WinHeight:e.height,boxOffsetLeft:d.left,boxOffsetTop:d.top,translateX:j,translateY:k,lhb:a.data("data").lhb?1:0},a.data("data").lhb&&"lhb"),a.data("show",1)}}var a=this,b=a.global,c=b.dragLineG,d=b.offset,e=b.$winSet,f=b.halfOneKWidth,g=b.tradeScale;return b.tradeG.on("click",function(a){var b=a.target;h($(b),b.tagName)}),a},kClick:function(){var a=this.global,b=a.dragLineG,c=a.kG,d=a.settings.stock,e=a.settings.xAxis,f=a.offset,g=a.$winSet,h=a.kCoord,i=h.x,j=h.topY,k=a.halfOneKWidth;return c.on("click","g",function(){var m,c,h,l,a=$(this);a.data("show")||(c=a.index(),h=i[c]+k+.5,l=j[c],m=b.appendSE("path",{d:"M0 0 0 0",transform:"translate("+h+","+l+")"}),createTimeShow(a,m,{$WinWidth:g.width,$WinHeight:g.height,boxOffsetLeft:f.left,boxOffsetTop:f.top,translateX:h,translateY:l,stock:d,time:e[c]}),a.data("show",1))}),this},noticeClick:function(){var c,d,e,f,g,h,i,a=this.global,b=a.noticeG;b&&(c=a.dragLineG,d=a.offset,e=a.$winSet,f=a.halfOneKWidth,g=f+50,h=a.kCoord.x,i=a.notice,b.on("click.charts","path",function(){var b,j,k,l,m,a=$(this);a.data("show")||(b=a.index(),j=i[b],k=h[j.index]+f,l=c.appendSE("path",{d:"M0 0 0 0",transform:"translate("+k+","+g+")"}),m=[],j.text.forEach(function(a){m.push('<div class="content"><header>'+a.title+"</header>"+'<p class="gray-text">'+a.date+"</p>"+"<p>"+a.content+"</p>"+"</div>")}),createShow('<header class="capi-title">公司公告</header>',m.join(""),a,l,{$WinWidth:e.width,$WinHeight:e.height,boxOffsetLeft:d.left,boxOffsetTop:d.top,translateX:k,translateY:g},3),a.data("show",1))}))},marketClick:function(a,b){if(a){var c=this.global,d=c.dragLineG,e=c.offset,f=c.$winSet,g=c.halfOneKWidth,h=addPointFive(c.svgHeight-c.chartBottomHeight-20),i=c.kCoord.x,j=WIN.syncChartsData.k.series.market;a.on("click.charts","circle",function(){function q(){k.text.forEach(function(a,b){p.push('<p><a href="'+siteUrl+"news/view/"+k.id[b]+"/"+stkCode+'" target="_blank">'+a+"</a>&nbsp;&nbsp;&nbsp;&nbsp;影响力："+k.infl[b]+"</p>")}),createShow('<header class="capi-title">'+k.time+"</header>",'<div class="content"><p class="bold">当天市场关注度指数：'+j.data[l]+"</p><p>当天重要新闻：</p>"+p.join("")+"</div>",a,o,{$WinWidth:f.width,$WinHeight:f.height,boxOffsetLeft:e.left,boxOffsetTop:e.top,translateX:m,translateY:n,isMarket:1},0),a.data("show",1)}var c,k,l,m,n,o,p,a=$(this);a.data("show")||(c=a.index(),k=j.event[c],l=k.index,m=i[l]+g,n=h+b[l],o=d.appendSE("path",{d:"M0 0 0 0",transform:"translate("+m+","+n+")"}),p=[],k.text?q():$.ajax({url:siteUrl+"stock/heatnews/"+stkCode+"/"+k.id.join("|"),dataType:"json"}).done(function(b){k.infl=[],k.text=[],b.forEach(function(a){k.infl.push(a.heat),k.text.push(a.title)}),q(),a.data("hasMarketData",1)}))})}},update:function(a){var v,w,x,y,z,A,B,C,D,E,b=this.global,c=b.xInLen,d=b.max,e=b.min,f=b.maxVol,h=(b.minVol,b.kColor),i=b.ky,j=b.kTranslateY,l=(b.kHeight,$(".capi-dynamic",b.kG)),m=$("rect",l),n=a.high,o=a.low,p=a.close,q=a.open,r=a.vol,t=(a.time,1),u=WIN.syncChartsData.k;u.series.data[c]=[q,n,o,p,a.vol,a.zdf+"%"],f&&r>f&&(t=0),d>=n&&o>=e&&t?(v=j+i(n),w=j+i(o),x=MathAbs(v-w),y=q-p,z=q,A=h.green,0>y?(A=h.red,z=p):0==y&&"+"==a.zdf.charAt(0)&&(A=h.red),m.eq(0).attr({y:v,height:x}),m.eq(1).attr({y:j+i(z),height:MathAbs(i(q)-i(p))||1}),m.eq(2).attr({y:v,height:x}),l.attr("fill")!=A&&l.attr("fill",A),f&&(B=$("rect.last",b.volG),C=b.volBarHeight,D=b.volSpaceHeight,E=b.volHCalc(a.vol),B.attr({y:MathFloor(C-E+D),height:E,fill:A}))):WIN.redraw.k(b.box,u,b.settings.hasBar)},modal_bottomTit:function(a,b,c){var g,h,d=a.appendSE("text",{y:16}),e=[],f=c.length;for(h=0;f>h;h++)g=d.appendSE("tspan",{cursor:"pointer",fill:b[MathFloor(h/2)]}).text(c[h]),h%2||g.attr("dx",10),e.push(g);return{allTspan:e,textElem:d}},changeBottom:function(a){var b=this;$(".capi-market").trigger("dblclick.charts"),b.global.chartBottomG.find(">g").remove(),b.createKChartIndex(a)},macd:function(){var l,m,n,o,p,q,r,s,t,u,v,a=this,b=a.global,c=b.xInLen,d=b.chartBottomG.appendSE("g"),e=WIN.syncChartsData.k.series.macd,f=e.dif,g=e.dea,h=e.bar,i=["#2ACBEE","#CC22BA","#C00"],j=["DIF：",f[c],"DEA：",g[c],"MACD：",h[c]],k=a.modal_bottomTit(d,i,j);b.add({macdAllTspan:k.allTspan}),l=b.chartBottomHeight-20,m=b.kCoord.x,n=b.halfOneKWidth,o=arrMaximin([f,g,h]),p=MathMax(o.max,MathAbs(o.min)),q=l/(2*p),calcY=function(a){return MathFloor((p-a)*q)},r=[],s=l/2,t=d.appendSE("g",{transform:"translate(0,"+MathFloor(s+20)+")"}),u=MathCeil(b.oneKWidth),[f,g].forEach(function(a,b){var e,c="M";a.forEach(function(a,b){var d=calcY(a)+20;c+=m[b]+n+" "+d+" "}),e=d.appendSE("path",{"class":"capi-kline",d:c,fill:"none",stroke:i[b]}),r.push(e)}),v=function(){var a=l/(2*p);return function(b){return MathFloor((p-b)*a)}}(),h.forEach(function(a,b){var c=v(a),d=a>0?1:0,e=MathFloor(c-s);t.appendSE("rect",{width:u,height:MathAbs(e),x:m[b],y:(d?e:0)+.5,fill:d?i[2]:"#2EC196"})}),r.push(t),a.macdTitClick(k.textElem,r,i,k.allTspan)},macdTitClick:function(a,b,c,d){function g(a,c,e){var f=2*a;d[f].attr("fill",c),d[f+1].attr("fill",c),b[a].attr("visibility",e)}var e="#ccc",f={0:1,1:1,2:1};a.on("click.charts","tspan",throttle(function(){var b,a=0;switch($(this).index()){case 2:case 3:a=1;break;case 4:case 5:a=2}b=f[a],b?g(a,e,"hidden"):g(a,c[a],"visible"),f[a]=!b},0,200))},emptyBottom:function(){$(".capi-market").trigger("dblclick.charts"),this.global.chartBottomG.find(">g").remove()},kdj:function(){this.createKdjRsi("kdj",["#2B9DFC","#FFB828","#CC22BA"],["k","d","j"])},rsi:function(){this.createKdjRsi("rsi",["#9A2875","#E5CA4E","#0AC2EA"],["rsi6","rsi12","rsi24"])},createKdjRsi:function(a,b,c){var n,o,p,q,r,s,t,d=this,e=d.global,f=e.xInLen,g=e.chartBottomG.appendSE("g"),h=WIN.syncChartsData.k.series[a],i=h[c[0]],j=h[c[1]],k=h[c[2]],l=[c[0].toUpperCase()+"：",i[f],c[1].toUpperCase()+"：",j[f],c[2].toUpperCase()+"：",k[f]],m=d.modal_bottomTit(g,b,l);e[a+"AllTspan"]=m.allTspan,n=e.chartBottomHeight-20,o=e.kCoord.x,p=e.halfOneKWidth,q=[i,j,k],r=arrMaximin(q),s=r.max,t=n/(s-r.min),calcY=function(a){return MathFloor((s-a)*t)},shapeElemSet=[],q.forEach(function(a,c){var e,d="M";a.forEach(function(a,b){var e,c=o[b];c!=UNDEFINED&&(e=calcY(a)+20,d+=c+p+" "+e+" ")}),e=g.appendSE("path",{"class":"capi-kline",d:d,fill:"none",stroke:b[c]}),shapeElemSet.push(e)}),d.macdTitClick(m.textElem,shapeElemSet,b,m.allTspan)}},Timechart.prototype={settings:function(a,b){var j,k,l,m,n,o,c=this,d=$.extend(!0,{style:{font:'12px "\\5FAE\\8F6F\\96C5\\9ED1"',overflow:"hidden","box-sizing":"border-box"},title:"分时图",delist:0,dynamic:0,hasBar:0,xAxis:[],series:{}},b),e=a.appendSE("svg",{width:"100%",height:"100%",xmlns:SVG.ns}).css(d.style),f=e.width(),g=e.height(),h=g-50,i=pInt(e.css("font-size"));return!d.series.data.length||10>f||80>g?e.remove():d.delist?e.appendSE("text",{x:f/2,y:g/2+f/28,fill:"#ccc","text-anchor":"middle","font-size":f/10}).text("停牌"):(j=createSE("g"),k=d.xAxis.length,l=k-1,m=d.series,n=m.data,o={gray:"#ccc",blue:"#3D6AA9",dragLine:"#333",zero:"#DD2200",dot:"#418fcf",gradient:["rgba(61, 106, 169, 1)","rgba(61, 106, 169, 0)"]},c.global={box:a,svg:e,main:j,settings:d,series:m,time:n,svgWidth:f,svgHeight:g,gradientHeight:h,fontSize:i,xLength:k,lastIndex:l,color:o},c.init(),e.append(j),void 0)},init:function(){var m,o,a=this,b=this.global,c=b.settings,d=c.hasBar,e=b.box,f=e.offset(),g=f.left,h=f.top,j=(b.svgHeight,b.gradientHeight),k=j,l=b.svgWidth/240,n=[];d&&(m=.2*j,j*=.8,k=.8*j),b.time.forEach(function(a){n.push(a[2]-0)}),n=arrMaximin(n),o=arrMax([MathAbs(n.max),MathAbs(n.min)]),$.extend(this.global,{maxZdf:o,boxOffsetLeft:g,boxOffsetTop:h,barHeight:m,gradientHeight:j,lineHeight:k,oneSpaceWidth:l,calcY:function(){var a=k/(2*o);return function(b){return MathFloor((o-b)*a)}}()}),a.method()},method:function(){with(this){var sets=global.settings;bg(),dragLine(),title(),timeShape(),sets.dynamic&&flashDot(),sets.hasBar&&bar(),xAxis(),zero(),sets.series.icon[0]&&icon(),move()}},bg:function(){var a=this.global,b=a.svgWidth,c=a.main.appendSE("g",{stroke:a.color.gray,"stroke-dasharray":6}),d=["29.5",a.svgHeight-20.5];d.forEach(function(a){c.appendSE("path",{d:"M0 "+a+" "+b+" "+a,"stroke-dasharray":0})}),$.extend(a,{bgG:c})},dragLine:function(){var a=this.global,b=a.main.appendSE("g",{stroke:a.color.dragLine});$.extend(a,{dragG:b})},title:function(){var a=this.global,b=a.settings,c=a.lastIndex,d=a.time;title=createTitle(a.fontSize,a.main,[b.title,b.xAxis[c],"价：",d[c][0],"量：",formatVol(d[c][1]),"幅：",d[c][2]+"%"]),$.extend(a,{title:title})},timeShape:function(){var a=this.global,c=(a.gradientHeight,a.oneSpaceWidth),d=a.main.appendSE("g"),e=a.calcY,f=a.color,g="M",h={x:[],y:[]};a.time.forEach(function(a,b){var d=MathFloor(c*b),f=e(a[2])+29;g+=d+" "+f+" ",h.x.push(d),h.y.push(f)}),d.appendSE("path",{d:g+"V"+MathFloor(a.svgHeight-20)+"H0",fill:f.blue,opacity:.2}),d.appendSE("path",{d:g,fill:"none",stroke:f.blue,"stroke-width":2}),$.extend(a,{timeG:d,lineCoord:h})},flashDot:function(){var a=this.global,b=a.lineCoord,c=a.lastIndex,d=a.main.appendSE("circle",{"class":"capi-dynamic",cx:b.x[c],cy:b.y[c],r:4,fill:a.color.gradient[0]});$.extend(a,{flashDot:d})},bar:function(){var h,a=this.global,b=a.barHeight,c=a.lineCoord.x,d=a.time,e=a.main.appendSE("g",{transform:"translate(0,"+MathFloor(a.gradientHeight+30)+")",fill:a.color.blue}),f=[],g=[];d.forEach(function(a){f.push(a[1])}),f=arrMax(f),h=b/f,d.forEach(function(a,d){var i,f=MathFloor(a[1]*h);0>f&&(f=0),i=MathFloor(b-f),e.appendSE("rect",{x:c[d],y:i,width:1,height:f}),g.push(i)}),$.extend(a,{maxVol:f,barG:e,barYCoord:g,barScale:h,barHeight:b})},xAxis:function(){var a=this.global,c=(a.settings,a.svgHeight),d=a.oneSpaceWidth,e=c-20,f=a.bgG,g=a.main.appendSE("g",{transform:"translate(0,"+(c-6)+")"});["09:30","10:30","11:30 / 13:00","14:00","15:00"].forEach(function(b,c){var h=0,i="middle";switch(c){case 0:i="start";break;case 4:i="end",h=a.svgWidth;break;default:h=addPointFive(60*d*c),f.appendSE("path",{d:"M"+h+" 29.5 "+h+" "+e})}g.appendSE("text",{x:h,"text-anchor":i}).text(b)})},zero:function(){var a=this.global,b=a.svgWidth,c=a.lineHeight,d=MathFloor(c/2)+29.5,e=a.color,f=a.main.appendSE("g");f.appendSE("path",{d:"M0 "+d+" "+b+" "+d,stroke:e.zero,"stroke-dasharray":6}),f.appendSE("text",{x:b-2,y:d-4,"text-anchor":"end"}).text("0.00%")},icon:function(){createIcon(this.global,1)},move:function(){timeMove(this.global,"time")},update:function(a){var m,n,o,p,q,r,s,t,v,u,b=this.global,d=(b.lastIndex,b.barHeight),e=b.barScale,f=b.maxZdf,g=b.maxVol,h=a.close,i=a.timeVol,j=a.zdf,k=1,l=WIN.syncChartsData.time;l.xAxis.push(a.date+" "+a.time),l.series.data.push([h,i,j]),g&&i>g&&(k=0),f>=j&&j>=-f&&k?(n=$("path",b.timeG),o=n.eq(1),p=o.attr("d"),q=MathFloor(b.oneSpaceWidth*++b.lastIndex),r=b.calcY(j)+29,s=p+q+" "+r+" ",t=b.lineCoord,t.x.push(q),t.y.push(r),n.eq(0).attr({d:s+"V"+MathFloor(b.svgHeight-20)+"H0"}),o.attr({d:s}),b.flashDot.attr({cx:q,cy:r}),g&&(m=b.barG,u=MathFloor(i*e),0>u&&(u=0),v=MathFloor(d-u),m.appendSE("rect",{x:q,y:v,width:1,height:u}),b.barYCoord.push(v))):WIN.redraw.time(l)}},Evtlinechart.prototype={settings:function(a,b){var j,k,l,m,n,o,c=this,d=$.extend(!0,{style:{font:'12px "\\5FAE\\8F6F\\96C5\\9ED1"',overflow:"hidden","box-sizing":"border-box"},title:"市场关注度走势",xAxis:[],series:{}},b),e=a.appendSE("svg",{width:"100%",height:"100%",xmlns:SVG.ns}).css(d.style),f=e.width(),g=e.height(),h=g-50,i=pInt(e.css("font-size"));return 10>f||80>g?e.remove():(j=createSE("g"),k=d.xAxis.length,l=k-1,m=d.series,n=m.data,o={gray:"#ccc",blue:"rgba(0, 52, 116, .8)",dragLine:"#333",dot:"#418fcf",gradient:["#3D6AA9","rgba(61, 106, 169, 0)"]},c.global={box:a,svg:e,main:j,settings:d,series:m,data:n,svgWidth:f,svgHeight:g,gradientHeight:h,fontSize:i,xLength:k,lastIndex:l,color:o},c.init(),e.append(j),void 0)},init:function(){var m,a=this,b=this.global,d=(b.settings,b.box),e=d.offset(),f=e.left,g=e.top,i=(b.svgHeight,b.gradientHeight),j=.86*i,k=b.svgWidth/b.lastIndex,l=[];b.data.forEach(function(a){l.push(a-0)}),l=arrMaximin(l),m=l.max,$.extend(this.global,{boxOffsetLeft:f,boxOffsetTop:g,gradientHeight:i,lineHeight:j,oneSpaceWidth:k,calcY:function(){var a=j/(m-l.min);return function(b){return MathFloor((m-b)*a)}}()}),a.method()},method:function(){with(this)bg(),dragLine(),title(),marketLineShape(),xAxis(),global.settings.series.icon[0]&&icon(),move()},bg:function(){var a=this.global,b=a.svgWidth,c=a.main.appendSE("g",{stroke:a.color.gray}),d=a.svgHeight-20.5;c.appendSE("path",{d:"M0 "+d+" "+b+" "+d}),$.extend(a,{bgG:c})},dragLine:function(){var a=this.global,b=a.main.appendSE("g",{stroke:a.color.dragLine});$.extend(a,{dragG:b})},title:function(){var a=this.global,b=a.settings,c=a.lastIndex,d=a.data,e=createTitle(a.fontSize,a.main,[b.title,b.xAxis[c],d[c]]);$.extend(a,{title:e})},marketLineShape:function(){var a=this.global,b=a.gradientHeight,c=a.oneSpaceWidth,d=a.main.appendSE("g"),e=a.calcY,f=a.color,g=a.svg.appendSE("defs").appendSE("linearGradient",{id:"gradient",x1:0,y1:0,x2:0,y2:1}),h="M",i={x:[],y:[]};[0,1].forEach(function(a){g.appendSE("stop",{offset:a,"stop-color":f.gradient[a]})}),a.data.forEach(function(a,b){var d=MathFloor(c*b),f=e(a)+29;h+=d+" "+f+" ",i.x.push(d),i.y.push(f)}),d.appendSE("path",{d:h+"V"+MathFloor(b+29.5)+"H0",fill:"url(#gradient)"}),d.appendSE("path",{d:h,fill:"none",stroke:f.blue,"stroke-width":1}),$.extend(a,{lineG:d,lineCoord:i})},xAxis:function(){var g,h,i,j,k,a=this.global,b=a.svgHeight,c=a.settings.xAxis,d=a.bgG,e=a.main.appendSE("g",{transform:"translate(0,"+(b-6)+")"}),f=MathRound(a.xLength/3);for(j=0;4>j;j++){switch(j){case 0:g=0,i=c[0],h="start";break;case 3:g=a.svgWidth-.5,i=c[a.lastIndex],h="end";break;default:k=f*j,g=a.lineCoord.x[k]+.5,i=c[k],h="middle"}j&&d.appendSE("path",{d:"M"+g+" "+(b-27)+" "+g+" "+(b-20)}),e.appendSE("text",{x:g,"text-anchor":h}).text(i?i:j)}},icon:function(){createIcon(this.global)},move:function(){timeMove(this.global)}},function(){function e(a,b){var c=a.data("show");c?b.trigger("dblclick"):b.click(),a.data("show",!c)}function f(a,b){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,c=a.data("dis");c?(d=c.title,e=c.oldHtml,f=c.dragLine,h=c.x,i=c.y,j=c.left,k=c.top,l=c.oldDragLine_d,m=c.$WinWidth,n=c.$WinHeight,p=c.boxOffsetLeft,q=c.boxOffsetTop):(d=a.attr("title"),e=a[0].textContent,f=$(DOC.getElementById("capi-ev-"+e)),g=f.attr("transform"),h=+g.replace(/.+\((.+)[,| ].+/,"$1"),i=+g.replace(/.+[,| ](.+)\)/,"$1"),j=a.css("left"),k=a.css("top"),l=f.attr("d"),m=$WIN.width(),n=$WIN.height(),o=f.parents("svg").parent().offset(),p=o.left,q=o.top,a.data("dis",{title:d,oldHtml:e,dragLine:f,x:h,y:i,left:j,top:k,oldDragLine_d:l,$WinWidth:m,$WinHeight:n,boxOffsetLeft:p,boxOffsetTop:q})),createShow("","",a,f,{$WinWidth:m,$WinHeight:n,boxOffsetLeft:p,boxOffsetTop:q,translateX:h,translateY:i,title:d,oldLeft:j,oldTop:k,oldHtml:e,oldDragLine_d:l,type:b},2)}function g(a,b,e){var f=a?c:d;f&&f.removeClass(e),b.addClass(e),a?c=b:d=b}function h(c){if(c.lenght){var d=c.position().top,e=c.outerHeight(),f=a.scrollTop();(f>d||d+e>f+b)&&(f>d?a.scrollTop(d):a.scrollTop(d+e-b))}}var c,d,a=$(".event"),b=a.outerHeight();$DOC.off("click.charts"),$DOC.on("mouseover.charts",".capi-evIcon",function(){var b=$('[data-capi-evt="'+$(this).attr("id").substring(4)+'"]',a);g(1,b,"active"),h(b)}).on("dblclick.charts",".charts",function(){$(".capi-evInfo, .capi-ev-timeInfo, .capi-timeChart, .capi-notice, .capi-trade").trigger("dblclick.charts")}).on("click.charts",".capi-evIcon",function(){f($(this))}).on("click.charts",".capi-ev-timeIcon",function(){f($(this),1)}),a.on("mouseover.charts","li[data-capi-evt]",function(){var b,a=$(this);b=$("#nid-"+a.attr("data-capi-evt")),g(1,a,"active"),g(0,b,"capi-evActive")}).on("mouseleave.charts",function(){d&&d.removeClass("capi-evActive")}).on("click.charts","li[data-capi-evt]",function(){e($(this),$("#nid-"+$(this).attr("data-capi-evt")))}).on("click.charts","li[data-capi-notice]",function(){e($(this),$(this).data("show")?$(".notice-"+$(this).attr("data-capi-notice")):$("#notice-"+$(this).attr("data-capi-notice")))}).on("click.stopEvt","a",function(a){a.stopPropagation()})}(),function(){function a(a,b,c){var d=a.html();a.html(b+(d.substring(3,d.length-1)-0+1)+c)}function b(b,c,d){c.prepend('<li><div class="user"><div class="content"><p class="blue-text">'+b.send_nickname+(b.to_nickname?" 回复 "+b.to_nickname:"")+"</p>"+"<div>"+b.content+"</div>"+'<div class="clearfix reply-time">'+'<time class="fl">'+b.addtime+"</time>"+'<span id="show-'+b.id+'" class="fr">回复</span>'+"</div>"+"</div>"+'<div id="reply-'+b.id+'" class="reply-user lightgray-bg-color">'+"<div>"+'<textarea class="form-control"></textarea>'+"<div>"+'<i class="btn btn-default" data-newsId="'+b.sid+'" data-replay="'+b.id+'" data-type="2">回复</i>'+"</div>"+"</div>"+"</div>"+"</div>"+"</li>"),a(d,"回复(",")"),a(d.parents(".comment-list").prev().find("p"),"评论（","）")}$DOC.on("click.capiComment","[class^=capi-ev] .reply-time span",function(){$("#reply-"+$(this).attr("id").substring(5)).stop().slideToggle()}).on("click.capiComment","[class^=capi-ev] .btn-default",function(){var c=$(this),d=c.parent(),e=d.prev(),f=e.val().trim(),g=f.length;return 5>g?(alert("评论不能少于5个字"),void 0):g>500?(alert("评论不能大于500个字"),void 0):($.ajax({type:"POST",url:siteUrl+"message/comment_add",data:{content:f,news_id:c.attr("data-newsId"),news_reply:c.attr("data-replay")},dataType:"json"}).done(function(f){var g,h;switch(f.status){case 404:return showLoginModal(),void 0;case 700:switch(g=f.comment,c.attr("data-type")){case"0":c.parents(".comment-submit").next().prepend('<li class="wrap clearfix"><div class="content"><p class="blue-text">'+g.send_nickname+(g.to_nickname?" 回复 "+g.to_nickname:"")+"</p>"+"<div>"+g.content+"</div>"+'<div class="clearfix reply-time">'+'<time class="fl">'+g.addtime+"</time>"+'<span id="show-'+g.id+'" class="fr">回复(0)</span>'+"</div>"+"</div>"+'<div id="reply-'+g.id+'" class="reply-user lightgray-bg-color">'+"<div>"+'<textarea class="form-control"></textarea>'+"<div>"+'<i class="btn btn-default" data-newsId="'+g.sid+'" data-replay="'+g.id+'" data-type="1">回复</i>'+"</div>"+"</div>"+'<ol class="user-sec"></ol>'+"</div>"+"</li>"),a(d.parents(".comment-submit").find("p"),"评论（","）");break;case"1":b(g,d.parent().next(),d.parents(".reply-user").prev().find(".reply-time span"));break;case"2":h=d.parents(".user-sec"),b(g,h,h.parent().prev().find(".reply-time span"))}e.val("")}}),void 0)})}(),$.fn.extend({capiDrag:function(a){var b=$(this),c=$DOC;return b.mousedown(function(d){if("textarea"!=d.target.tagName.toLowerCase()){b.css("zIndex",++GLOBAL.zIndex);var e=b.offset(),f=d.pageX-e.left,g=d.pageY-e.top;return a.down&&a.down.call(this,f,g,d),c.on("mousemove.drag",throttle(function(c){var d=c[0],e=d.pageX-f,h=d.pageY-g;b.css({left:e,top:h}),a.move&&a.move.call(this,e,h)},0,26)).on("mouseup.drag",function(){c.off("mousemove.drag mouseup.drag"),a.up&&a.up.apply(this,arguments)}),!1}})},appendSE:function(a,b){return createSE(a).attrSE(b).appendTo($(this))},attrSE:function(a){return $(this).each(function(){if(!a)return!0;for(var b in a)"xlink:href"==b?this.setAttributeNS(SVG.xlink,b,a[b]):this.setAttribute(b,a[b])})},Ycharts:function(Options){var _this=$(this).eq(0),type=Options.type,t;switch(type&&type.trim()){case"time":t="Time";break;case"k":t="K";break;case UNDEFINED:case"line":t="Line";break;case"evtline":t="Evtline";break;default:throw new TypeError(type+" is not defined")}return $(".capi-loading-svg",_this).remove(),GLOBAL[t+"chart"]=eval("new "+t+"chart(_this,Options)"),_this}})});